<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>一笔一爱</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="./css/animate.css">
    <link rel="stylesheet" href="./css/index.css">

    <script type="text/javascript">
        
    var evt = "onorientationchange" in window ? "orientationchange" : "resize";
    function resize() {
        var html = document.documentElement,
        fontSize = 100,//100为根元素字体大小
        pageW = 375,//设计稿页面宽度
        pageH = 604,//设计稿页面高度
        //根据具体情况修改宽高值，可以用页面主体内容的宽高值
        wk = 414;//页面大小缩放的上限阀值，当页面大小超过此值时将不再放大页面
        hk = 672;//页面大小缩放的上限阀值，当页面大小超过此值时将不再放大页面
        if (html.clientWidth / html.clientHeight > pageW / pageH) {
            if (html.clientHeight <= hk) {
                html.style.fontSize = html.clientHeight / pageH * fontSize + "px";
            } else {
                html.style.fontSize = hk / pageH * fontSize + "px";
            }
        } else {
            if (html.clientWidth <= wk) {
                html.style.fontSize = html.clientWidth / pageW * fontSize + "px";
            } else {
                html.style.fontSize = wk / pageW * fontSize + "px";
            }
        }
    }
    resize();
    
    </script>

    <!-- Demo styles -->
    <style>
    .swiper-container {
        width: 100%;
        height: 100%;
    }
    .swiper-slide {
        /*text-align: center;*/
        /*font-size: 18px;*/
        /*background: #fff;*/
        display: -webkit-box;
        display: -ms-flexbox;
        display: -webkit-flex;
        display: flex;
        -webkit-box-pack: center;
        -ms-flex-pack: center;
        -webkit-justify-content: center;
        justify-content: center;
        -webkit-box-align: center;
        -ms-flex-align: center;
        -webkit-align-items: center;
        align-items: center;
    }
    </style>
</head>
<body>

    <div style="position: absolute; opacity: 0; z-index: -1; width: 0; height: 0; overflow: hidden;">
        <img src="./images/thumb.png" alt="share_cover">
    </div>

    <!-- 横屏提示代码 [[ -->
    <div id="orientation_hinter" class="landscape">
        <div class="hinter_phone"><i></i></div>
        <div class="hinter_rotate"></div>
        <div class="hinter_text landscape">竖屏体验效果更佳</div>
        <div class="hinter_text portrait">横屏体验效果更佳</div>
    </div>
    <!-- 横屏提示代码 ]] -->

    <!-- 竖屏提示代码 [[ -->
    <!-- <div id="orientation_hinter" class="portrait">
        <div class="hinter_phone"><i></i></div>
        <div class="hinter_rotate"></div>
        <div class="hinter_text landscape">竖屏体验效果更佳</div>
        <div class="hinter_text portrait">横屏体验效果更佳</div>
    </div> -->
    <!-- 竖屏提示代码 ]] -->



    <!-- LOADING代码 [[ -->
    <div class="preloader loading">
        <div class="preloader-container">
            <div class="preloader-img">
                <div class="red-heart"></div>
                <div class="pink-heart2"></div>
                <div class="pink-heart3"></div>
            </div>
            <div class="preloader-text">已加载<span class="preloader-percent percent">0%</span></div>
        </div>
    </div>
    <!-- LOADING代码 ]] -->


    <!-- 页面主体 [[ -->
    <div class="swiper-container">
        <div class="swiper-wrapper">
            <!-- <div class="swiper-slide s1">
                <div class="wrap">
                    <div class="wrap__pic wrap__pic-blur wrap__pic-1"></div>
                    <div class="wrap__text">我们正在寻找希望</div>
                </div>
            </div> -->
            <div class="swiper-slide s1">
                <div class="wrap">
                    <!-- <ul class="txt-list">
                        <li class="sq sq-1">爱之于我，</li>
                        <li class="sq sq-2">不是肌肤之亲，</li>
                        <li class="sq sq-3">不是一蔬一饭，</li>
                        <li class="sq sq-4">她是一种不死的欲望，</li>
                        <li class="sq sq-5">是我疲惫生活的英雄梦想。</li>
                    </ul>
                    <p class="author sq sq-6">—— 杜拉斯</p> -->
                    <div class="test-special">
                        <div class="red"></div>
                        <div class="blue"></div>
                        <div class="green"></div>
                        <div class="yellow"></div>
                        <div class="purple"></div>
                    </div>
                    <p class="tips sq sq-7">此刻，让我们爱在一起</p>
                    <div class="page-down">
                        <div class="icon"></div>
                    </div>
                </div>
            </div>
            <div class="swiper-slide s2">
                <div class="wrap">
                    <div class="love">
                        <div class="love__item li-1" data-index="1">
                            <div class="avater">
                                <img src="./images/avater2.png" alt="捐赠人">
                            </div>
                        </div>
                        <div class="love__item li-2" data-index="2">
                            <div class="avater">
                                <img src="./images/avater3.png" alt="捐赠人">
                            </div>
                        </div>
                        <div class="love__item li-3" data-index="3">
                            <div class="avater">
                                <img src="./images/avater1.png" alt="捐赠人">
                            </div>
                        </div>
                        <div class="love__item li-4" data-index="4">
                            <div class="avater">
                                <img src="./images/avater4.png" alt="捐赠人">
                            </div>
                        </div>
                        <div class="love__item li-5" data-index="5">
                            <div class="avater">
                                <img src="./images/avater5.png" alt="捐赠人">
                            </div>
                        </div>
                        <div class="love__item love__item--uncompleted li-6" data-index="6">
                            <div class="avater">
                                <img src="./images/avater6.png" alt="捐赠人">
                            </div>
                        </div>
                        <div class="love__item li-7" data-index="7">
                            <div class="avater">
                                <img src="./images/avater7.png" alt="捐赠人">
                            </div>
                        </div>
                        <div class="love__item li-8" data-index="8">
                            <div class="avater">
                                <img src="./images/avater8.png" alt="捐赠人">
                            </div>
                        </div>
                        <div class="love__item li-9" data-index="9">
                            <div class="avater">
                                <img src="./images/avater9.png" alt="捐赠人">
                            </div>
                        </div>
                        <div class="love__item love__item--uncompleted li-10" data-index="10">
                            <div class="avater">
                                <img src="./images/avater10.png" alt="捐赠人">
                            </div>
                        </div>

                        <div class="love__txt-area">
                            <div class="pay current p-0">
                                <p>点击笔划，为爱填充</p>
                            </div>
                            <div class="pay p-lge0">
                                <!-- <p>再画一笔 <span>或</span></p> -->
                                <button id="share-love" type="button" class="btn">让朋友一起填充爱</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- <div class="swiper-slide s3">
                <div class="wrap">
                    3
                </div>
            </div>
            <div class="swiper-slide s4">
                <div class="wrap">
                    4
                </div>
            </div> -->
        </div>
        <!-- Add Pagination -->
        <!-- <div class="swiper-pagination"></div> -->
        
    </div>
    <!-- 页面主体 ]] -->



    <!-- 捐款弹窗 [[ -->
    <div class="dialog-mask"></div>
    <div class="dialog" id="dialog1">
        <div class="dialog__close" id="dialog-close"></div>
        <div class="dialog__love-thumb"></div>
        <div class="dialog__video">
            <img src="./images/video.png">
            <div class="dialog__video--play"></div>
        </div>
        <div class="dialog__info">
            <div class="dialog__title">点亮爱心书桌</div>
            <div class="dialog__desc">“爱心书桌”是由我要装修网发起，陕西青少年发展基金会及各地教育局联合主办，家居建材商家参与捐赠的一项长期公益行动。</div>
        </div>
        <div class="dialog__opr">
            <button type="button" id="donate-btn" class="btn"> 为爱捐赠9.9元 </button>
        </div>
        <div class="dialog__ft">
            <div class="gongyi-logo"></div>
        </div>
    </div>
    <!-- 捐款弹窗 ]] -->
    

    <!-- Modal [[ -->
    <!-- <div class="modal-mask" style="display: block;"></div>
    <div class="modal" id="modal">
        <div class="modal_close">x</div>
        <div class="modal__hd">
            <img src="../images/avater1.png" alt="">
        </div>
        <div class="modal__bd">
            <p class="name">陈洁婷</p>
            <p class="desc">已向“为盲胞阅读”项目
            <br>捐赠了9.9元</p>
        </div>  
        <div class="modal__ft">
            <div class="gongyi-logo"></div>
        </div>
    </div> -->

    <div class="fulllove">
        <img src="./images/fulllove.png">
    </div>
    <div class="dialog" id="dialog-modal">
        <div class="dialog__close" id="dialog-close"></div>
        <div class="dialog__love-thumb"></div>
        <div class="modal__hd">
            <div class="donate-user-avater">
                <img src="./images/avater1.png" alt="">
            </div>
        </div>
        <div class="modal__bd">
            <p class="name">陈某某</p>
            <p class="desc">已向“为盲胞阅读”项目
            <br>捐赠了9.9元</p>
        </div>  
        <div class="modal__ft">
            <div class="gongyi-logo"></div>
        </div>
        <div class="dialog__ft">
            <div class="gongyi-logo"></div>
        </div>
    </div>
    <!-- Modal [[ -->




    <!-- 提示分享 [[ -->
    <div class="share-layer" style="display: none;">
        <div class="share-layer__icon">
            
        </div>
        
    </div>
    <!-- 提示分享 ]] -->


    

    <!-- 音频代码 [[ -->
    <a href="javascript:;" id="bgMusicContr" class="music"></a>
    <audio id="bgMusic" src="./media/love.mp3" loop="" preload="auto"></audio>
    <!-- 音频代码 ]] -->



    <!-- Swiper JS -->
    <script src="./js/zepto.min.js"></script>
    <script src="./js/swiper.jquery.min.js"></script>
    <script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
    <script src="./js/preloader.js"></script>

    <!-- Initialize Swiper -->
    <script>
    (function() {

        'use strict';
        // 预加载资源
        var preload = [
            './media/love.mp3',
            './images/sound.png',
            './images/sound_muted.png',
            './images/landscape_hint@2x.png',
            './images/landscape_phone@2x.png',
            './images/loading_1.png',
            './images/loading_2.png',
            './images/c_l1.png',
            './images/l1.png',
            './images/c_l2.png',
            './images/l2.png',
            './images/c_l3.png',
            './images/l3.png',
            './images/c_l4.png',
            './images/l4.png',
            './images/c_l5.png',
            './images/l5.png',
            './images/c_l6.png',
            './images/l6.png',
            './images/c_l7.png',
            './images/l7.png',
            './images/c_l8.png',
            './images/l8.png',
            './images/c_l9.png',
            './images/l9.png',
            './images/c_l10.png',
            './images/l10.png',
            './images/avater1.png',
            './images/avater2.png',
            './images/avater3.png',
            './images/avater4.png',
            './images/avater5.png',
            './images/avater6.png',
            './images/avater7.png',
            './images/avater8.png',
            './images/avater9.png',
            './images/avater10.png',
            './images/avater.png',
            './images/99gongyi.png',
            './images/red1.png',
            './images/green1.png',
            './images/blue1.png',
            './images/purple1.png',
            './images/yellow1.png',
            './images/close.png',
            './images/cover.jpg',
            './images/dialog_love_thumb.png',
            './images/downicon.png',
            './images/video_play.png',
            './images/video.png'
        ];

        var clickEvent = (document.ontouchstart!==null) ? 'click' : 'touchstart';
        var transitionEvent = whichTransitionEvent();
        var animationEvent = whichAnimationEvent();


        function whichTransitionEvent(){
            var t,
                el = document.createElement("fakeelement");

            var transitions = {
                "transition"      : "transitionend",
                "OTransition"     : "oTransitionEnd",
                "MozTransition"   : "transitionend",
                "WebkitTransition": "webkitTransitionEnd"
            }

            for (t in transitions){
                if (el.style[t] !== undefined){
                    return transitions[t];
                }
            }
        }

        function whichAnimationEvent(){
            var t,
                el = document.createElement("fakeelement");

            var animations = {
                "animation"      : "animationend",
                "OAnimation"     : "oAnimationEnd",
                "MozAnimation"   : "animationend",
                "WebkitAnimation": "webkitAnimationEnd"
            }

            for (t in animations){
                if (el.style[t] !== undefined){
                    return animations[t];
                }
            }
        }
        
        // 预加载动画
        new preloader({
            files: preload,
            progress: function(err, response, percent) {
                $('.percent').text(percent + '%');
            },
            complete: function() {
                // 隐藏加载器
                $('.preloader').addClass('loaded');
                $('.preloader').on(animationEvent, function() {
                    $('.preloader').remove();
                });
                var swiper = new Swiper('.swiper-container', {
                    direction: 'vertical',
                    pagination: '.swiper-pagination',
                    paginationClickable: true
                });

                // 每次打开的时候判断一下localstorage，是否播放音乐
                if (typeof localStorage !== undefined) {
                    var musicDefault = localStorage.getItem('musicDefault');
                    if(musicDefault === 'true') {
                        bgAudio.play();
                    }
                } else {
                    bgAudio.play();
                }
            }
        });

        wx.ready(function() {

            // 分享到朋友圈
            wx.onMenuShareTimeline({
                title: '一笔一爱', // 分享标题
                // link: 'http://wj.qq.com/activities/2016/04/cdc_ten/index.html', // 分享链接
                link: window.location.href,
                imgUrl: 'http://www.padding-left.com/wp-content/jt/2424hours/images/thumb.png', // 分享图标
                success: function () {
                    // 用户确认分享后执行的回调函数
                    typeof MtaH5 !== 'undefined' && MtaH5.clickStat('cdc10.sharetimeline');
                },
                cancel: function () {
                    // 用户取消分享后执行的回调函数
                }
            });

            // 分享给好友
            wx.onMenuShareAppMessage({
                title: '一笔一爱', // 分享标题
                desc: '一横一竖爱满溢', // 分享描述
                // link: 'http://wj.qq.com/activities/2016/04/cdc_ten/index.html', // 分享链接
                link: window.location.href,
                imgUrl: 'http://www.padding-left.com/wp-content/jt/2424hours/images/thumb.png', // 分享图标
                type: 'link', // 分享类型,music、video或link，不填默认为link
                dataUrl: '', // 如果type是music或video，则要提供数据链接，默认为空
                success: function () {
                    // 用户确认分享后执行的回调函数
                    typeof MtaH5 !== 'undefined' && MtaH5.clickStat('cdc10.sharefriend');
                },
                cancel: function () {
                    // 用户取消分享后执行的回调函数
                }
            });
        });

        // 背景音乐控制
        var bgMusic = $('#bgMusic');
        var bgMusicContr = $('#bgMusicContr');
        var bgAudio = document.getElementById("bgMusic");
        $(document).on(clickEvent, '#bgMusicContr', function(e) {
            var $this = $(this);
            if (!$this.hasClass('playing')) {
                document.getElementById("bgMusic").play();
                typeof localStorage !== undefined && localStorage.setItem('musicDefault', true);
            } else {
                document.getElementById("bgMusic").pause();
                typeof localStorage !== undefined && localStorage.setItem('musicDefault', false);
            }
        });

        // 播放事件
        bgMusic.on('play', function() {
            bgMusicContr.addClass('playing');
        });

        // 暂停事件
        bgMusic.on('pause', function() {
            bgMusicContr.removeClass('playing');
        });

        // 对不支持自动播放的设备使用一次性的 touchstart 事件触发
        $(document).one('touchstart', function() {
            if (typeof localStorage !== undefined) {
                var musicDefault = localStorage.getItem('musicDefault');
                if(musicDefault === 'true') {
                    bgAudio.play();
                }
            } else {
                bgAudio.play();
            }
        });
        

        var cUrl = window.location.href.replace(window.location.hash, '');
        $.ajax({
            url: 'http://5minute.cdc.qq.com/wxjssdk-signature/sign.php',
            type: 'GET',
            data: {url: cUrl},
            dataType: 'jsonp',
            success: function(res) {
                wx.config({
                        debug: false,
                        appId: res.data.appId,
                        timestamp: res.data.timestamp,
                        nonceStr: res.data.nonceStr,
                        signature: res.data.signature,
                        jsApiList: [
                            'onMenuShareTimeline',
                            'onMenuShareAppMessage',
                            'onMenuShareQQ',
                            'onMenuShareWeibo',
                            'onMenuShareQZone',
                            'startRecord',
                            'stopRecord',
                            'onVoiceRecordEnd',
                            'playVoice',
                            'pauseVoice',
                            'stopVoice',
                            'onVoicePlayEnd',
                            'uploadVoice',
                            'downloadVoice'
                        ]
                });
            }
        });


        var targetLoveItemIndex = 0;
        var $modal = $('#dialog-modal');
        var $modalMask = $('.modal-mask');
        var modalShowTime = 2000;
        var $dialog = $('#dialog1');
        var $dialogMask = $('.dialog-mask');
        // 填充爱
        $('.love__item--uncompleted').on(clickEvent, toFillLove);


        function toFillLove(e){
            $(this).addClass('donating');
            targetLoveItemIndex = $(this).index();
            // console.log(targetLoveItemIndex);
            $dialog.show();
            $dialogMask.show();
            // if($('.love__item--uncompleted').length - 1 == 0){
            //     console.log('full')
            // }
        }

        var dcount = 0;
        // 打开弹窗
        $('#donate-btn').on(clickEvent, function(){
            dcount ++;

            if(dcount == 2){
                setTimeout(function(){
                    // alert('full');
                    $('.fulllove').show();
                }, 2000)
            }

            // 跳转到微信支付
            setTimeout(function(){
                $dialog.hide();
                $('.dialog-mask').hide();
                // “爱”字填充动画
                $('.love__item').eq(targetLoveItemIndex).removeClass('love__item--uncompleted').addClass('love__item--completed');
                $('.love__item--completed').off(toFillLove);
                $('.p-0').removeClass('current');
                $('.p-lge0').addClass('current');
            }, 500);

            setTimeout(function(){
                $('.love__item--completed').on(clickEvent,function(){
                    $modal.show();
                    $dialogMask.show();

                    // modal 出现一段时间后自动关闭
                    // setTimeout(function(){
                    //     $modal.hide();
                    //     $modalMask.hide();
                    // }, modalShowTime);
                })
            }, 800);
        })

        $('.love__item').on(clickEvent,function(){
            // console.log($(this).hasClass('love__item--uncompleted'));
            if( !$(this).hasClass('love__item--uncompleted')){
                $modal.show();
                $dialogMask.show();
                // setTimeout(function(){
                //     $modal.hide();
                //     $modalMask.hide();
                // }, modalShowTime);
            }
        })

        // 关闭modal
        // $dialogMask.on(clickEvent, function(){
        //     // alert('close');
        //     $(this).hide();
        //     $('.dialog').hide();
        // })

        // 关闭弹窗
        $('.dialog__close').on(clickEvent, function(){
            $('.dialog').hide();
            $('.dialog-mask').hide();
        })

        // 分享提示出现之后，点击该提示区域即可让提示消失
        $('.share-layer').on(clickEvent,function(){
            $(this).hide();
        })

        // $('#share-love').on(clickEvent,function(){
        //     $('.share-layer').show();
        // })


    })();
    </script>
    <script src="./js/comm.js"></script>
</body>
</html>