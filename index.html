<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>标题标题</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="./css/animate.css">
    <link rel="stylesheet" href="./css/index.css">

    <script type="text/javascript">
        
    var evt = "onorientationchange" in window ? "orientationchange" : "resize";
    function resize() {
        var html = document.documentElement,
        fontSize = 100,//100为根元素字体大小
        pageW = 375,//设计稿页面宽度
        pageH = 604,//设计稿页面高度
        //根据具体情况修改宽高值，可以用页面主体内容的宽高值
        wk = 414;//页面大小缩放的上限阀值，当页面大小超过此值时将不再放大页面
        hk = 672;//页面大小缩放的上限阀值，当页面大小超过此值时将不再放大页面
        if (html.clientWidth / html.clientHeight > pageW / pageH) {
            if (html.clientHeight <= hk) {
                html.style.fontSize = html.clientHeight / pageH * fontSize + "px";
            } else {
                html.style.fontSize = hk / pageH * fontSize + "px";
            }
        } else {
            if (html.clientWidth <= wk) {
                html.style.fontSize = html.clientWidth / pageW * fontSize + "px";
            } else {
                html.style.fontSize = wk / pageW * fontSize + "px";
            }
        }
    }
    resize();
    
    </script>

    <!-- Demo styles -->
    <style>
    .swiper-container {
        width: 100%;
        height: 100%;
    }
    .swiper-slide {
        /*text-align: center;*/
        /*font-size: 18px;*/
        /*background: #fff;*/
        display: -webkit-box;
        display: -ms-flexbox;
        display: -webkit-flex;
        display: flex;
        -webkit-box-pack: center;
        -ms-flex-pack: center;
        -webkit-justify-content: center;
        justify-content: center;
        -webkit-box-align: center;
        -ms-flex-align: center;
        -webkit-align-items: center;
        align-items: center;
    }
    </style>
</head>
<body>



    <!-- 横屏提示代码 [[ -->
    <div id="orientation_hinter" class="landscape">
        <div class="hinter_phone"><i></i></div>
        <div class="hinter_rotate"></div>
        <div class="hinter_text landscape">竖屏体验效果更佳</div>
        <div class="hinter_text portrait">横屏体验效果更佳</div>
    </div>
    <!-- 横屏提示代码 ]] -->

    <!-- 竖屏提示代码 [[ -->
    <!-- <div id="orientation_hinter" class="portrait">
        <div class="hinter_phone"><i></i></div>
        <div class="hinter_rotate"></div>
        <div class="hinter_text landscape">竖屏体验效果更佳</div>
        <div class="hinter_text portrait">横屏体验效果更佳</div>
    </div> -->
    <!-- 竖屏提示代码 ]] -->



    <!-- LOADING代码 [[ -->
    <div class="preloader loading">
        <div class="preloader-container">
            <div class="preloader-img">
                <div class="red-heart"></div>
                <div class="pink-heart2"></div>
                <div class="pink-heart3"></div>
            </div>
            <div class="preloader-text">已加载<span class="preloader-percent percent">0%</span></div>
        </div>
    </div>
    <!-- LOADING代码 ]] -->


    <!-- 页面主体 [[ -->
    <div class="swiper-container">
        <div class="swiper-wrapper">
            <!-- <div class="swiper-slide s1">
                <div class="wrap">
                    <div class="wrap__pic wrap__pic-blur wrap__pic-1"></div>
                    <div class="wrap__text">我们正在寻找希望</div>
                </div>
            </div> -->
            <div class="swiper-slide s1" style="display: none;">
                <div class="wrap">
                    引入页
                </div>
            </div>
            <div class="swiper-slide s2">
                <div class="wrap">
                    <div class="love">
                        <div class="love__title">
                            点击笔划，为爱填充
                        </div>
                        <div class="love__item li-1" data-index="1">
                            <div class="avater">
                                <!-- <img src="" alt=""> -->
                            </div>
                        </div>
                        <div class="love__item li-2" data-index="2">
                            <div class="avater">
                                <!-- <img src="" alt=""> -->
                            </div>
                        </div>
                        <div class="love__item li-3" data-index="3">
                            <div class="avater">
                                <!-- <img src="" alt=""> -->
                            </div>
                        </div>
                        <div class="love__item li-4" data-index="4">
                            <div class="avater">
                                <!-- <img src="" alt=""> -->
                            </div>
                        </div>
                        <div class="love__item li-5" data-index="5">
                            <div class="avater">
                                <!-- <img src="" alt=""> -->
                            </div>
                        </div>
                        <div class="love__item love__item--uncompleted li-6" data-index="6">
                            <div class="avater">
                                <!-- <img src="" alt=""> -->
                            </div>
                        </div>
                        <div class="love__item li-7" data-index="7">
                            <div class="avater">
                                <!-- <img src="" alt=""> -->
                            </div>
                        </div>
                        <div class="love__item li-8" data-index="8">
                            <div class="avater">
                                <!-- <img src="" alt=""> -->
                            </div>
                        </div>
                        <div class="love__item li-9" data-index="9">
                            <div class="avater">
                                <!-- <img src="" alt=""> -->
                            </div>
                        </div>
                        <div class="love__item love__item--uncompleted li-10" data-index="10">
                            <div class="avater">
                                <img src="" alt="">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="swiper-slide s3">
                <div class="wrap">
                    3
                </div>
            </div>
            <div class="swiper-slide s4">
                <div class="wrap">
                    4
                </div>
            </div>
        </div>
        <!-- Add Pagination -->
        <!-- <div class="swiper-pagination"></div> -->
    </div>
    <!-- 页面主体 ]] -->



    <!-- 捐款弹窗 [[ -->
    <div class="dialog-mask"></div>
    <div class="dialog" id="dialog">
        <div class="dialog__close" id="dialog-close"></div>
        <div class="dialog__love-thumb"></div>
        <div class="dialog__video">
            <img src="./images/video.png">
            <div class="dialog__video--play"></div>
        </div>
        <div class="dialog__info">
            <div class="dialog__title">点亮爱心书桌</div>
            <div class="dialog__desc">“爱心书桌”是由我要装修网发起，陕西青少年发展基金会及各地教育局联合主办，家居建材商家参与捐赠的一项长期公益行动。</div>
        </div>
        <div class="dialog__opr">
            <button type="button" id="donate-btn" class="btn"> 为爱填充 </button>
        </div>
    </div>
    <!-- 捐款弹窗 ]] -->
    

    <!-- Modal [[ -->
    <div class="modal-mask"></div>
    <div class="modal" id="modal" style="display: none;">
        <p>modal</p>
    </div>
    <!-- Modal [[ -->




    <!-- 提示分享 [[ -->
    <div class="share-layer" style="display: none;">
        <div class="share-layer__icon">
            
        </div>
        
    </div>
    <!-- 提示分享 ]] -->


    

    <!-- 音频代码 [[ -->
    <a href="javascript:;" id="bgMusicContr" class="music"></a>
    <audio id="bgMusic" src="https://demo.cdc.im/luke/wechatPro/assets/media/music.1dfb.mp3" loop="" preload="auto"></audio>
    <!-- 音频代码 ]] -->



    <!-- Swiper JS -->
    <script src="./js/zepto.min.js"></script>
    <script src="./js/swiper.jquery.min.js"></script>
    <script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
    <script src="./js/preloader.js"></script>

    <!-- Initialize Swiper -->
    <script>
    (function() {

        'use strict';
        // 预加载资源
        var preload = [
            // './media/music.1dfb.mp3',
            './images/sound.png',
            './images/sound_muted.png',

        ];

        var clickEvent = (document.ontouchstart!==null) ? 'click' : 'touchstart';
        var transitionEvent = whichTransitionEvent();
        var animationEvent = whichAnimationEvent();


        function whichTransitionEvent(){
            var t,
                el = document.createElement("fakeelement");

            var transitions = {
                "transition"      : "transitionend",
                "OTransition"     : "oTransitionEnd",
                "MozTransition"   : "transitionend",
                "WebkitTransition": "webkitTransitionEnd"
            }

            for (t in transitions){
                if (el.style[t] !== undefined){
                    return transitions[t];
                }
            }
        }

        function whichAnimationEvent(){
            var t,
                el = document.createElement("fakeelement");

            var animations = {
                "animation"      : "animationend",
                "OAnimation"     : "oAnimationEnd",
                "MozAnimation"   : "animationend",
                "WebkitAnimation": "webkitAnimationEnd"
            }

            for (t in animations){
                if (el.style[t] !== undefined){
                    return animations[t];
                }
            }
        }
        
        // 预加载动画
        new preloader({
            files: preload,
            progress: function(err, response, percent) {
                $('.percent').text(percent + '%');
            },
            complete: function() {
                // 隐藏加载器
                $('.preloader').addClass('loaded');
                $('.preloader').on(animationEvent, function() {
                    $('.preloader').remove();
                    // setTimeout(function() {
                    //     $('.point .avatar').remove();
                    // }, 200);
                });
                var swiper = new Swiper('.swiper-container', {
                    direction: 'vertical',
                    pagination: '.swiper-pagination',
                    paginationClickable: true
                });

                // 每次打开的时候判断一下localstorage，是否播放音乐
                // if (typeof localStorage !== undefined) {
                //     var musicDefault = localStorage.getItem('musicDefault');
                //     if(musicDefault === 'true') {
                //         bgAudio.play();
                //     }
                // } else {
                //     bgAudio.play();
                // }
            }
        });






        // var swiper = new Swiper('.swiper-container', {
        //     pagination: '.swiper-pagination',
        //     paginationClickable: true
        // });


        // var clickEvent = (document.ontouchstart!==null) ? 'click' : 'touchstart';

        wx.ready(function() {

            // 分享到朋友圈
            wx.onMenuShareTimeline({
                title: '标题标题标题标题', // 分享标题
                // link: 'http://wj.qq.com/activities/2016/04/cdc_ten/index.html', // 分享链接
                link: window.location.href,
                imgUrl: 'http://www.padding-left.com/wp-content/jt/24hours/images/cover.jpg', // 分享图标
                success: function () {
                    // 用户确认分享后执行的回调函数
                    typeof MtaH5 !== 'undefined' && MtaH5.clickStat('cdc10.sharetimeline');
                },
                cancel: function () {
                    // 用户取消分享后执行的回调函数
                }
            });

            // 分享给好友
            wx.onMenuShareAppMessage({
                title: '标题标题标题标题', // 分享标题
                desc: 'descdescdesc', // 分享描述
                // link: 'http://wj.qq.com/activities/2016/04/cdc_ten/index.html', // 分享链接
                link: window.location.href,
                imgUrl: 'http://www.padding-left.com/wp-content/jt/24hours/images/cover.jpg', // 分享图标
                type: 'link', // 分享类型,music、video或link，不填默认为link
                dataUrl: '', // 如果type是music或video，则要提供数据链接，默认为空
                success: function () {
                    // 用户确认分享后执行的回调函数
                    typeof MtaH5 !== 'undefined' && MtaH5.clickStat('cdc10.sharefriend');
                },
                cancel: function () {
                    // 用户取消分享后执行的回调函数
                }
            });
        });

        

        var cUrl = window.location.href.replace(window.location.hash, '');
        $.ajax({
            url: 'http://5minute.cdc.qq.com/wxjssdk-signature/sign.php',
            type: 'GET',
            data: {url: cUrl},
            dataType: 'jsonp',
            success: function(res) {
                wx.config({
                        debug: false,
                        appId: res.data.appId,
                        timestamp: res.data.timestamp,
                        nonceStr: res.data.nonceStr,
                        signature: res.data.signature,
                        jsApiList: [
                            'onMenuShareTimeline',
                            'onMenuShareAppMessage',
                            'onMenuShareQQ',
                            'onMenuShareWeibo',
                            'onMenuShareQZone',
                            'startRecord',
                            'stopRecord',
                            'onVoiceRecordEnd',
                            'playVoice',
                            'pauseVoice',
                            'stopVoice',
                            'onVoicePlayEnd',
                            'uploadVoice',
                            'downloadVoice'
                        ]
                });
            }
        });


        var targetLoveItemIndex = 0;
        var $modal = $('#modal');
        var $modalMask = $('.modal-mask');
        var modalShowTime = 2000;
        var $dialog = $('#dialog');
        var $dialogMask = $('.dialog-mask');
        // 填充爱
        $('.love__item--uncompleted').on(clickEvent, toFillLove);


        function toFillLove(e){
            $(this).addClass('donating');
            targetLoveItemIndex = $(this).index();
            // console.log(targetLoveItemIndex);
            $dialog.show();
            $dialogMask.show();
        }

        // 打开弹窗
        $('#donate-btn').on(clickEvent, function(){
            // 跳转到微信支付
            setTimeout(function(){
                $dialog.hide();
                $('.dialog-mask').hide();
                // “爱”字填充动画
                $('.love__item').eq(targetLoveItemIndex - 1).removeClass('love__item--uncompleted').addClass('love__item--completed');
                $('.donating').off(toFillLove);
            }, 500);

            setTimeout(function(){
                $('.love__item--completed').on(clickEvent,function(){
                    $modal.show();
                    $modalMask.show();

                    // modal 出现一段时间后自动关闭
                    setTimeout(function(){
                        $modal.hide();
                        $modalMask.hide();
                    }, modalShowTime);
                })
            }, 800);
        })

        $('.love__item').on(clickEvent,function(){
            // console.log($(this).hasClass('love__item--uncompleted'));
            if( !$(this).hasClass('love__item--uncompleted')){
                $modal.show();
                $modalMask.show();
                setTimeout(function(){
                    $modal.hide();
                    $modalMask.hide();
                }, modalShowTime);
            }
        })

        // 关闭弹窗
        $('#dialog-close').on(clickEvent, function(){
            $dialog.hide();
            $('.dialog-mask').hide();
        })

        // 分享提示出现之后，点击该提示区域即可让提示消失
        $('.share-layer').on(clickEvent,function(){
            $(this).hide();
        })


    })();
    </script>
    <script src="./js/comm.js"></script>
</body>
</html>